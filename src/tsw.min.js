/*! Theresa's Sound World 0.0.1 (c) 2013 Stuart Memo %> */
(function(t,e){var n=function(){var n=function(t){if(webkitAudioContext.prototype.createGain===e){if(webkitAudioContext.prototype.createGainNode===e)throw Error("Sorry, your browser doesn't support a recent enough version of the Web Audio API.");webkitAudioContext.prototype.createGain=webkitAudioContext.prototype.createGainNode,webkitAudioContext.prototype.createScriptProcessor=webkitAudioContext.prototype.createJavaScriptNode}this.context=t||new webkitAudioContext,this.version="0.0.1",this.speakers=this.context.destination,this.processors=[],this.context.createGain=this.context.createGainNode;try{this.context.createGain()}catch(n){}r()&&(this.music=new tswMusic(this))};n.prototype.now=function(){return this.context.currentTime};var r=function(){return t.tswMusic?!0:!1},a=function(t,e){for(attr in e)t[attr]=e[attr];return t};n.prototype.applySettings=function(t,e){for(setting in e)t[setting].value=e[setting]},n.prototype.connect=function(){for(var t=0;arguments.length-1>t;t++)if(Array.isArray(arguments[t]))for(var e=0;arguments[t].length>e;e++)this.connect(arguments[t][e],arguments[t+1]);else arguments[t].hasOwnProperty("output")?arguments[t+1].hasOwnProperty("input")?arguments[t].output.connect(arguments[t+1].input):arguments[t].output.connect(arguments[t+1]):arguments[t+1].hasOwnProperty("input")?arguments[t].connect(arguments[t+1].input):arguments[t].connect(arguments[t+1])},n.prototype.disconnect=function(t){t.disconnect()},n.prototype.load=function(t,e){var n={},r=0,a=0,o=this,i=function(t,e,n,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){r++,o.context.decodeAudioData(s.response,function(e){n[t]=o.context.createBufferSource(),n[t].buffer=e,n[t].play=function(){o.play(this)},n[t].stop=function(){o.stop(this)},n[t].isPlaying=function(){return this.playbackState},r===a&&i(n)})},s.send()};if("object"==typeof t)for(var s in t)a++,i(s,t[s],n,e);else{if("string"!=typeof t)throw Error("Files must be an array or a valid string.");a=1,i(s,t[s],n,e)}},n.prototype.play=function(t){t.start(0)},n.prototype.stop=function(t){t.stop(0)},n.prototype.reverse=function(t){for(var e=0;t.buffer.numberOfChannels>e;e++)Array.prototype.reverse.call(t.buffer.getChannelData(e));return t},n.prototype.createPanner=function(){},n.prototype.createOscillator=function(t,n){var r=this.context.createOscillator();return r.start===e&&(r.start=r.noteOn,r.stop=r.noteOff),t=t||"SINE",t=t.toUpperCase(),r.type=r[t],r.safariType=t.toLowerCase(),r.frequency.value=n||440,r},n.prototype.createGain=function(t){var e;return e="function"==typeof this.context.createGain?this.context.createGain():this.context.createGainNode(),e.gain.value=t||1,e},n.prototype.createFilter=function(t){var e=t||"lowpass",n=this.context.createBiquadFilter();return n.type=e,n},n.prototype.createAnalyser=function(){return this.context.createAnalyser()},n.prototype.createCompressor=function(t){var e=this.context.createDynamicsCompressor(),n={threshold:-24,knee:30,ratio:12,attack:.003,release:.25};return t=a(n,t),this.applySettings(e,t),e},n.prototype.createProcessor=function(t,e){var n=t||1024,r=tsw.context.createScriptProcessor(n,1,1);return"function"==typeof e&&(r.onaudioprocess=function(t){e(t)}),r},n.prototype.createWaveShaper=function(){for(var t=new Float32Array(65536),e=0;32768>e;e++)t[e]=3e4>e?.1:-1;var n=this.context.createWaveShaper();return n.curve=t,n},n.prototype.createEnvelope=function(t){var n={};return n.startLevel=t.startLevel||0,n.maxLevel=t.maxLevel||1,n.minLevel=t.minLevel||0,n.attackTime=t.attackTime||0,n.decayTime=t.decayTime||0,n.sustainLevel=t.sustainLevel||0,n.releaseTime=t.releaseTime||0,n.param=t.param,n.param.value=n.startLevel,n.autoStop=t.autoStop===e?!0:t.autoStop,n.start=function(t){this.maxLevel=this.startLevel+this.maxLevel,this.sustainLevel=this.startLevel+this.sustainLevel,this.startTime=t||tsw.now(),this.attackTime=this.startTime+this.attackTime,this.decayTime=this.attackTime+this.decayTime,this.param.cancelScheduledValues(this.startTime),this.param.setValueAtTime(this.startLevel,this.startTime),this.param.linearRampToValueAtTime(this.maxLevel,this.attackTime),this.param.linearRampToValueAtTime(this.startLevel+this.sustainLevel,this.decayTime),this.autoStop&&this.stop(this.decayTime)},n.stop=function(t){t=t||tsw.now(),t+=this.releaseTime,this.param.linearRampToValueAtTime(this.startLevel,t)},n},n.prototype.createNoise=function(){var t=this.context.createScriptProcessor(1024,0,1);return t.onaudioprocess=function(t){for(var e=0;1024>e;e++)t.outputBuffer.getChannelData(0)[e]=2*Math.random()-1},t},n.prototype.createLFO=function(t){var e=tsw.createOscillator(),n=this.createGain(),r={frequency:0,waveType:"triangle",depth:1,target:null,autoStart:!1};return t=a(r,t),e.type=e[t.waveType]||e.TRIANGLE,n.gain.value=t.depth,e.frequency.value=t.frequency,t.autoStart&&e.start(tsw.now()),e.modulate=function(t){this.connect(n),n.connect(t)},e.setWaveType=function(t){e.type=e[t.toUpperCase()]},e.setFrequency=function(t){e.frequency.value=t},e.setDepth=function(t){n.gain.value=t},e.modulate(t.target),e};var o={};return o.createDelay=function(t){var e={},n=tsw.context.createDelay(),r=tsw.context.createGain(),a=tsw.context.createGain(),o=tsw.createGain();return e.input=tsw.createGain(),e.output=tsw.createGain(),e.settings={delayTime:.5,feedback:.5,effectLevel:.5},t=t||{},n.delayTime.value=t.delayTime||e.settings.delayTime,r.gain.value=t.feedback||e.settings.feedback,a.gain.value=t.effectLevel||e.settings.effectLevel,tsw.connect(e.input,o,n,r,n,a,e.output),tsw.connect(o,n),e},o.createDelay=function(t){var e={},n=tsw.context.createDelay(),r=tsw.context.createGain(),a=tsw.context.createGain(),o=tsw.createGain();return e.input=tsw.createGain(),e.output=tsw.createGain(),e.settings={delayTime:.5,feedback:.5,effectLevel:.5},t=t||{},n.delayTime.value=t.delayTime||e.settings.delayTime,r.gain.value=t.feedback||e.settings.feedback,a.gain.value=t.effectLevel||e.settings.effectLevel,tsw.connect(e.input,o,n,r,n,a,e.output),tsw.connect(o,n),e},o.createDistortion=function(t){var e={},n=context.createWaveShaper(),r=context.createBiquadFilter(),a=context.createBiquadFilter();return e.settings={distortionLevel:.5},t=t||{},e.input=tsw.createGain(),e.output=tsw.createGain(),tsw.connect(e.input,n,[r,a],e.output),e},o.createFlanger=function(){var t={};return t},o.createPhaser=function(t){var e={},n=[],r=tsw.createGain(),a={rate:8,depth:.5,feedback:.8};t=t||{},r.gain.value=t.gain||a.gain;for(var o=0;config.rate>o;o++)n[o]=tsw.context.createBiquadFilter(),n[o].type=7,n[o].frequency.value=100*o;e.input=tsw.createGain(),e.output=tsw.createGain();for(var o=0;n.length-1>o;o++)tsw.connect(n[o],n[o+1]);return tsw.connect(e.input,n[0],n[n.length-1],r,n[0]),tsw.connect(n[n.length-1],e.output),e.setCutoff=function(){for(var t=0;n.length>t;t++);},e},o.createReverb=function(t){var e=tsw.context.createConvolver(),n=tsw.createGain(),r={},a={effectLevel:.5,reverbTime:.5,reverbType:"spring",reverbPath:""};return t=t||{},n.gain.value=t.effectLevel||a.effectLevel,tsw.load({hall:"/effects/reverb/responses/bright-hall.wav",room:"/effects/reverb/responses/medium-room.wav",spring:"/effects/reverb/responses/feedback-spring.wav"},function(t){a.reverbPath=t[a.reverbType],e.buffer=a.reverbPath,r.input=tsw.createGain(),r.output=tsw.createGain(),tsw.connect(r.input,[r.output,e]),tsw.connect(e,n),tsw.connect(n,r.output)}),r},o.createTremolo=function(t){var e={},n=(tsw.createGain(),this.createLFO()),r=this;return t=t||{},e.input=tsw.createGain(),e.connect=function(t){e.input.connect(t),n.modulate(e.input.gain),n.start(r.now())},e.setRate=function(t){n.setFrequency(t)},e.setDepth=function(t){n.setDepth(t)},e},n.prototype.createEffect=function(t){return o["create"+t.charAt(0).toUpperCase()+t.slice(1)]()},function(t){return new n(t)}}();t.tsw=new n})(window);