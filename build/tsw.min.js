/* Theresa's Sound World 0.0.1 (c) 2013 Stuart Memo */
window.tsw=function(a,b){"use strict";var c=function(a,b){for(var c in b)a[c]=b[c];return a},d=function(a,b){for(var c in b)a[c].value=b[c]},e=function(a){return Array.isArray(a)},f=function(a){var b=!1;return Object(a)&&"node"in a&&(b=!0),b},g=function(a){return"undefined"!=typeof a.context},h=function(a){return a.hasOwnProperty("input")||a.hasOwnProperty("output")},i=function(a){return"setValueAtTime"in a},j={},k=[];j.version="0.0.1",j.isBrowserSupported=!1,j.processors=[];var l=function(){j.noise_buffer=j.createBuffer();for(var a=0;a<j.noise_buffer.length;a++)j.noise_buffer.getChannelData(0)[a]=2*Math.random()-1},m=function(a,b){if("undefined"==typeof webkitAudioContext&&"undefined"==typeof AudioContext)if("undefined"==typeof webkitAudioContext.prototype.createGainNode)b("Sorry, your browser doesn't support a recent enough version of the Web Audio API.");else{var c=webkitAudioContext.prototype;c.createGain=c.createGainNode,c.createDelay=c.createDelayNode,c.createScriptProcessor=c.createJavaScriptNode}else j.context="function"==typeof AudioContext?new AudioContext:new webkitAudioContext;j.isBrowserSupported=!0,a()},n=function(){j.speakers=j.context.destination};j.createNode=function(){var a={};return a.input=j.createGain(),a.output=j.createGain(),a.nodeType="default",a},j.now=function(){return this.context.currentTime},j.createChannelMerger=function(a){return j.context.createChannelMerger(a)},j.connect=function(){for(var a=function(){arguments[0].connect(arguments[1])},b=function(){arguments[0].connect(arguments[1].input)},c=function(){for(var a=0;a<arguments[1].length;a++)j.connect(arguments[0],arguments[1][a])},d=function(){for(var a=0;a<arguments[0].length;a++)j.connect(arguments[0][a],arguments[1])},i=function(){arguments[0].output.connect(arguments[1].input)},k=function(){arguments[0].output.connect(arguments[1])},l=function(){for(var a=0;a<arguments[0].length;a++)j.connect(arguments[0][a],arguments[1])},m=function(){for(var a=0;a<arguments[0].length;a++)j.connect(arguments[0][a],arguments[1])},n=function(){arguments[0].node.connect(arguments[1].node,arguments[0].channel,arguments[1].channel)},o=0;o<arguments.length-1;o++){var p=arguments[o],q=arguments[o+1];g(p)&&h(q)?b(p,q):h(p)&&g(q)?k(p,q):g(p)&&e(q)?c(p,q):e(p)&&g(q)?d(p,q):g(p)&&g(q)?a(p,q):h(p)&&h(q)?i(p,q):h(p)&&e(q)?connectTswNodeToArray(p,q):e(p)&&h(q)?l(p,q):e(p)&&e(q)?m(p,q):f(p)&&e(q)?connectObjectWithNodeToArray(p,q):e(p)&&f(q)?connectArrayToObjectWithNode(p,q):f(p)&&f(q)&&n(p,q)}},j.disconnect=function(){for(var a=arguments.length,b=0;a>b;b++)arguments[b].disconnect()},j.disconnectAfterTime=function(a,b){k.push({node:a,time:b})},j.load=function(){var a,b={},c=arguments[0],d="",e=[],f=0,g=0,h=this,i=function(a,b,c,d,e){var i=new XMLHttpRequest;i.open("GET",a+c,!0),i.responseType="arraybuffer",i.onload=function(){f++,h.context.decodeAudioData(i.response,function(a){a.play=function(a){var b=j.createBufferSource(this);b.start(j.now()||a)},d[b]=a,f===g&&e(d)})},function(a){console.log("Error decoding audio data",a)},i.send()};if("object"==typeof arguments[1]?(d=arguments[1].path||"",e=arguments[1].extensions||[]):"function"==typeof arguments[1]&&(a=arguments[1]),"function"==typeof arguments[2]&&(a=arguments[2]),"object"==typeof c)for(var k in c)g++,i(d,k,c[k],b,a);else{if("string"!=typeof c)throw new Error("Files must be an array or a valid string.");g=1,i(d,k,c[k],b,a)}},j.createDelay=function(a){var b=this.context.createDelay();return b.delayTime.value=a||0,b},j.createMonoMaker=function(){var a={};return a.input=j.createGain(),a.output=j.createGain(),j.connect(a.input,a.output),a},j.createPanner=function(a){var b={},c=j.createGain(1),d=j.createGain(0),e=j.createChannelMerger(2);return b.input=j.createGain(),b.output=j.createGain(),b.value=a,b.value>1?b.value=1:b.value<-1&&(b.value=-1),c.gain.value=1-100*.01*((1+b.value)/2),d.gain.value=1-c.gain.value,j.connect(b.input,[c,d]),j.connect({node:c,channel:0},{node:e,channel:0}),j.connect({node:d,channel:0},{node:e,channel:1}),j.connect(e,b.output),b},j.play=function(a,b){b=b||0,a.start(b)},j.stop=function(a,b){b=b||0,a.stop(b)},j.reverse=function(a){for(var b=0;b<a.buffer.numberOfChannels;b++)Array.prototype.reverse.call(a.buffer.getChannelData(b));return a};var o=function(a,b){a.connectedTo=[],b=b||{},a.get=function(b){return a[b].hasOwnProperty("value")?a[b].value:a[b].value},a.set=function(b){a.gain.value=b.gain||a.gain.value},b.hasOwnProperty("sourceNode")?(a.start=function(a){b.sourceNode.hasOwnProperty("start")?b.sourceNode.start(a):b.sourceNode.noteOn(a)},a.stop=function(a){b.sourceNode.hasOwnProperty("stop")?b.sourceNode.stop(a):b.sourceNode.noteOff(a)}):b.sourceNode=!1};j.createOscillator=function(a,b){var c=j.createNode(),d=this.context.createOscillator();return o(c,{sourceNode:d}),c.waveType=a||"sine",d.type=c.waveType.toLowerCase(),d.frequency.value=b||440,c.nodeType="oscillator",j.connect(d,c.output),c.frequency=function(a){return"undefined"==typeof a?d.frequency.value:(d.frequency.value=a,void 0)},c},j.createGain=function(a){var b;return b="function"==typeof this.context.createGain?this.context.createGain():this.context.createGainNode(),o(b),0>=a&&(a=0),"undefined"==typeof a&&(a=1),b.gain.value=a,b},j.createBuffer=function(a,b,c){a=a||1,b=b||65536,c=c||44100;var d=this.context.createBuffer(a,b,c);return d.play=function(a){var b=j.createBufferSource(this);b.start(a||j.now())},d},j.createBufferSource=function(a){var b=this.context.createBufferSource();return b.buffer=a,"undefined"==typeof b.start&&(b.start=b.noteOn,b.stop=b.noteOff),b},j.createFilter=function(a,b,c){var d={},e={},f=j.context.createBiquadFilter();return e.filterType=a||"lowpass",d.input=j.createGain(),d.output=j.createGain(),o(f,e),f.type=e.filterType,f.frequency.value=b||1e3,f.Q.value=c||0,d.frequency=function(a){return"undefined"==typeof a?f.frequency.value:(f.frequency.value=a,void 0)},j.connect(d.input,f,d.output),d},j.createAnalyser=function(){return this.context.createAnalyser()},j.createCompressor=function(a){var b=this.context.createDynamicsCompressor(),e={threshold:-24,knee:30,ratio:12,attack:.003,release:.25};return a=c(e,a),d(b,a),b},j.createProcessor=function(a,b){var c=a||1024,d=j.context.createScriptProcessor(c,1,1);return"function"==typeof b&&(d.onaudioprocess=function(a){b(a)}),d},j.createWaveShaper=function(){for(var a=new Float32Array(65536),b=0;32768>b;b++)a[b]=3e4>b?.1:-1;var c=this.context.createWaveShaper();return c.curve=a,c},j.createEnvelope=function(a){var c={};return a=a||{},c.name=a.name||"",c.startLevel=a.startLevel||0,c.maxLevel=a.maxLevel||1,c.minLevel=a.minLevel||0,c.attackTime=a.attackTime||0,c.decayTime=a.decayTime||0,c.sustainLevel=a.sustainLevel||0,c.releaseTime=a.releaseTime||0,c.param=a.param||{},c.param.value=c.startLevel,c.autoStop=a.autoStop===b?!0:a.autoStop,c.start=function(a){var b=a||j.now(),c=b+this.attackTime,d=c+this.decayTime,e=d+this.releaseTime;this.maxLevel=this.startLevel+this.maxLevel,this.sustainLevel=this.startLevel+this.sustainLevel,"setValueAtTime"in this.param&&(this.param.cancelScheduledValues(b),this.param.setValueAtTime(this.startLevel,b),this.param.linearRampToValueAtTime(this.maxLevel,c),this.param.linearRampToValueAtTime(this.startLevel+this.sustainLevel,d),this.autoStop&&(this.param.linearRampToValueAtTime(this.minLevel,e),this.stop(e)))},c.stop=function(a){a=a||j.now(),a+=this.releaseTime,!this.autoStop&&i(this.param)&&this.param.linearRampToValueAtTime(this.minLevel,a)},c},j.createNoise=function(a){var b=j.createNode(),c=this.createBufferSource(j.noise_buffer),d=j.createFilter("lowpass");return c.loop=!0,b.nodeType="noise",b.color=a||"white",d.frequency="pink"===b.color?1e3:1e4,o(b,{sourceNode:c}),j.connect(c,d,b.output),b},j.createLFO=function(a){var b=j.createOscillator(),d=this.createGain(),e={frequency:0,waveType:"triangle",depth:1,target:null,autoStart:!1};return a=c(e,a),b.type=b[a.waveType]||b.TRIANGLE,d.gain.value=a.depth,b.frequency.value=a.frequency,a.autoStart&&b.start(j.now()),b.modulate=function(a){this.connect(d),d.connect(a)},b.setWaveType=function(a){b.type=b[a.toUpperCase()]},b.frequency=function(a){return"undefined"==typeof a?b.frequency.value:(b.frequency.value=a,void 0)},b.setDepth=function(a){d.gain.value=a},b.modulate(a.target),b},j.getUserAudio=function(a){var b=function(b){var c=j.context.createMediaStreamSource(b);a(c)};navigator.webkitGetUserMedia({audio:!0},b)};var p=function(){!function a(){k.forEach(function(a){a.time<j.now()&&j.disconnect(a.node)}),setTimeout(a,500)}()};return function(){m(function(){n(),l(),p()},function(a){console.log(a)})}(),j}(window),function(a){"use strict";a.tsw=tsw||{},tsw.createDelay=function(a){var b={},c=tsw.context.createDelay(),d=tsw.context.createGain(),e=tsw.context.createGain(),f=tsw.createGain();return b.input=tsw.createGain(),b.output=tsw.createGain(),b.settings={delayTime:.5,feedback:.5,effectLevel:.5},a=a||{},c.delayTime.value=a.delayTime||b.settings.delayTime,d.gain.value=a.feedback||b.settings.feedback,e.gain.value=a.effectLevel||b.settings.effectLevel,tsw.connect(b.input,f,c,d,c,e,b.output),tsw.connect(f,c),b},tsw.createDistortion=function(a){var b={},c=tsw.context.createWaveShaper(),d=tsw.context.createBiquadFilter(),e=tsw.context.createBiquadFilter();return b.settings={distortionLevel:.5},a=a||{},b.input=tsw.createGain(),b.output=tsw.createGain(),tsw.connect(b.input,c,[d,e],b.output),b},tsw.createFlanger=function(){var a={};return a},tsw.createPhaser=function(a){var b={},c=[],d=tsw.createGain(),e={rate:8,depth:.5,feedback:.8};a=a||{},d.gain.value=a.gain||e.gain;for(var f=0;f<e.rate;f++)c[f]=tsw.context.createBiquadFilter(),c[f].type=7,c[f].frequency.value=100*f;b.input=tsw.createGain(),b.output=tsw.createGain();for(var f=0;f<c.length-1;f++)tsw.connect(c[f],c[f+1]);return tsw.connect(b.input,c[0],c[c.length-1],d,c[0]),tsw.connect(c[c.length-1],b.output),b.setCutoff=function(){for(var a=0;a<c.length;a++);},b},tsw.createReverb=function(a){var b=tsw.context.createConvolver(),c=tsw.createGain(),d={},e={effectLevel:.5,reverbTime:.5,reverbType:"spring",reverbPath:""};return a=a||{},c.gain.value=a.effectLevel||e.effectLevel,tsw.load({hall:"/effects/reverb/responses/bright-hall.wav",room:"/effects/reverb/responses/medium-room.wav",spring:"/effects/reverb/responses/feedback-spring.wav"},function(a){e.reverbPath=a[e.reverbType],b.buffer=e.reverbPath,d.input=tsw.createGain(),d.output=tsw.createGain(),tsw.connect(d.input,[d.output,b]),tsw.connect(b,c),tsw.connect(c,d.output)}),d},tsw.createTremolo=function(a){var b={},c=(tsw.createGain(),this.createLFO()),d=this;return a=a||{},b.input=tsw.createGain(),b.connect=function(a){b.input.connect(a),c.modulate(b.input.gain),c.start(d.now())},b.setRate=function(a){c.setFrequency(a)},b.setDepth=function(a){c.setDepth(a)},b},console.log(tsw)}(window),function(){"use strict";var a=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a.push.apply(a,a);var b=["unison","flat 2nd","2nd","minor 3rd","major 3rd","perfect 4th","flat 5th","perfect 5th","minor 6th","major 6th","minor 7th","major 7th","octave","flat 9th","9th","sharp 9th","major 10th","11th","augmented 11th","perfect 12th","flat 13th","13th"],c=function(b){for(var c,d=a.length,e=0;d>e;e++)if(b.toUpperCase()===a[e])return c=e,e;return null},d=function(b){var d=[],e=c(b);return d.push(a[e]),d.push(a[e+2]),d.push(a[e+4]),d.push(a[e+5]),d.push(a[e+7]),d.push(a[e+9]),d.push(a[e+11]),d.push(a[e+12]),d},e=function(b){var d=[],e=c(b);return d.push(a[e]),d.push(a[e+2]),d.push(a[e+3]),d.push(a[e+5]),d.push(a[e+7]),d.push(a[e+8]),d.push(a[e+10]),d.push(a[e+12]),d},f=function(a){return"string"!=typeof a||a.length>3?!1:!0};tsw.parseChord=function(b){var d={},e=[],f=0;return Array.isArray(b)?!1:(b=b.toLowerCase(),d.rootNote=b[0].toUpperCase(),d.isMajor=b.indexOf("maj")>-1,d.isMinor=!d.isMajor&&b.indexOf("m")>-1,d.is7th=b.indexOf("7")>-1,d.notes=[],d.is7th||(d.octave=b.match(/\d/g)),d.isMajor||d.isMinor?(f=c(d.rootNote),e.push(f),b.isMinor?e.push(f+tsw.getSemitoneDifference("minor 3rd")):e.push(f+tsw.getSemitoneDifference("major 3rd")),e.push(f+tsw.getSemitoneDifference("perfect 5th")),e.push(f+tsw.getSemitoneDifference("octave")),e.forEach(function(b){d.notes.push(a[b])}),d.notes):!1)},tsw.getScale=function(a,b){return"minor"===b?e(a):d(a)},tsw.getSemitoneDifference=function(a){for(var c=b.length,d=0;c>d;d++)if(a===b[d])return d},tsw.getChord=function(a){return this.parseChord(a)},tsw.chordToNotes=function(a){return a=this.parseChord(a),a.notes},tsw.sharpToFlat=function(a){var b;return a=a.replace("#","b"),b=String.fromCharCode(a[0].toUpperCase().charCodeAt(0)+1),"H"===b&&(b="A"),b+=a.substr(1)},tsw.flatToSharp=function(a){var b,c=0;return-1===a.indexOf("b")?a:(a=a.replace("b","#"),b=String.fromCharCode(a[0].toUpperCase().charCodeAt(0)-1),"@"===b&&(b="G"),"B"===b&&(c=a.search(/\d/),c>-1&&(a=a.substring(0,c)+(a[c]-1)+a.substring(c+1))),b+=a.substr(1))},tsw.getFrequency=function(b){var c,d,e,g;return f(b)===!1?!1:(e=b.search(/\d/),c=parseInt(b.slice(-1)),isNaN(c)&&(c=4),b=this.flatToSharp(b),g=b,e>-1&&(g=b.substr(0,e)),d=a.indexOf(g.toUpperCase()),d+=12*c,parseFloat(440*Math.pow(2,(d-57)/12),10))}}(window),function(a){"use strict";var b=function(){var a=function(a){this.context=a};return a.prototype.getUserMIDI=function(a,b){navigator.requestMIDIAccess().then(a,b)},a.prototype.MIDINumberToNote=function(a){var b=a%12,c=Math.floor(a/12),d=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return d[b]+c},a}();a.tsw.midi=new b}(window);