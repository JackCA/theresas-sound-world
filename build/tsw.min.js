/* Theresa's Sound World 0.0.1 (c) 2013 Stuart Memo */
(function(e,t){"use strict";var n,r="1.0.0";n=function(){var n=function(e,t){for(var n in t)e[n]=t[n];return e},o=function(e,t){for(var n in t)e[n].value=t[n]},a=function(e){return Array.isArray(e)},u=function(e){return"function"==typeof e},i=function(e){return"object"==typeof e},c=function(e){return"string"==typeof e},s=function(e){return e!==t},f=function(e){var t=!1;return Object(e)&&"node"in e&&(t=!0),t},p=function(e){return e.context!==t},l=function(e){return e.hasOwnProperty("input")||e.hasOwnProperty("output")},h=function(e){return i(e)?"setValueAtTime"in e:!1},v=function(e,n){var r=this;n.forEach(function(n){e[n]=function(e,o,a){return e===t?r[n].hasOwnProperty("value")?r[n].value:r[n]:(r[n].hasOwnProperty("value")?(s(o)&&(a=a||0,r[n].setTargetAtTime(r[n].value,d.now(),a),r[n].setTargetAtTime(e,o,a)),r[n].value=e):r[n]=e,t)}})},d={},m=[];d.version=r,d.isBrowserSupported=!1,d.processors=[];var g=function(){d.noise_buffer=d.buffer();for(var e=0;d.noise_buffer.buffer().length>e;e++)d.noise_buffer.buffer().getChannelData(0)[e]=2*Math.random()-1},y=function(e,n){var r;if("undefined"==typeof webkitAudioContext&&"undefined"==typeof AudioContext)if(webkitAudiocontext().prototype.createGainNode===t)n("Sorry, your browser doesn't support a recent enough version of the Web Audio API.");else{var o=webkitAudiocontext().prototype;o.createGain=o.createGainNode,o.createDelay=o.createDelayNode,o.createScriptProcessor=o.createJavaScriptNode}else"function"==typeof AudioContext?(r=new AudioContext,d.context=function(){return r}):(r=new webkitAudioContext,d.context=function(){return r});d.isBrowserSupported=!0,e()},w=function(){d.speakers=d.context().destination},b=function(e){e.output.gain.cancelScheduledValues(d.now()),e.output.gain.setValueAtTime(0,d.now()),e.output.gain.linearRampToValueAtTime(1,d.now()+2)},T=function(e){e.output.gain.cancelScheduledValues(d.now()),e.output.gain.setValueAtTime(1,d.now()),e.output.gain.linearRampToValueAtTime(0,d.now()+2)};d.now=function(){return this.context().currentTime},d.channelMerger=function(e){return d.context().createChannelMerger(e)},d.connect=function(){for(var e=function(){arguments[0].connect(arguments[1])},t=function(){arguments[0].connect(arguments[1].input)},n=function(){for(var e=0;arguments[1].length>e;e++)d.connect(arguments[0],arguments[1][e])},r=function(){for(var e=0;arguments[0].length>e;e++)d.connect(arguments[0][e],arguments[1])},o=function(){arguments[0].output.connect(arguments[1].input)},u=function(){arguments[0].output.connect(arguments[1])},i=function(){for(var e=0;arguments[0].length>e;e++)d.connect(arguments[0][e],arguments[1])},c=function(){for(var e=0;arguments[0].length>e;e++)d.connect(arguments[0][e],arguments[1])},s=function(){arguments[0].node.connect(arguments[1].node,arguments[0].channel,arguments[1].channel)},h=0;arguments.length-1>h;h++){var v=arguments[h],m=arguments[h+1];p(v)&&l(m)?t(v,m):l(v)&&p(m)?u(v,m):p(v)&&a(m)?n(v,m):a(v)&&p(m)?r(v,m):p(v)&&p(m)?e(v,m):l(v)&&l(m)?o(v,m):l(v)&&a(m)?connectTswNodeToArray(v,m):a(v)&&l(m)?i(v,m):a(v)&&a(m)?c(v,m):f(v)&&a(m)?connectObjectWithNodeToArray(v,m):a(v)&&f(m)?connectArrayToObjectWithNode(v,m):f(v)&&f(m)&&s(v,m)}},d.disconnect=function(){for(var e=arguments.length,t=0;e>t;t++)arguments[t].disconnect()},d.disconnectAfterTime=function(e,t){m.push({node:e,time:t})},d.load=function(){var e,t,n={},r=arguments[0].files,o=arguments[0].path||"",a=[],i=0,c=0,s=this,f=function(e,t,n,r,o,a){var f=new XMLHttpRequest;f.open("GET",e+n,!0),f.responseType="arraybuffer";var p=function(){i++,s.context().decodeAudioData(f.response,function(e){r[t]=e,Object.keys(r).length===c&&o(r)})},l=function(){u(a)?a():console.log("There was an error loading your file(s)",f.status)};f.onreadystatechange=function(){4===f.readyState&&(200===f.status?p():l())},f.send()};if("object"==typeof arguments[1]?(o=arguments[1].path||"",a=arguments[1].extensions||[]):"function"==typeof arguments[1]&&(e=arguments[1]),"function"==typeof arguments[2]&&(t=arguments[2]),"object"==typeof r){c=Object.keys(r).length;for(var p in r)f(o,p,r[p],n,e,t)}else{if("string"!=typeof r)throw Error("Files must be an array or a valid string.");c=1,f(o,p,r[p],n,e)}},d.wait=function(e){var t,n=this.context().createDelay();return e=e||1,t=d.createNode({nodeType:"delay"}),v.call(n,t,["delayTime"]),t.delayTime(e),d.connect(t.input,n,t.output),t},d.createMonoMaker=function(){var e={};return e.input=d.createGain(),e.output=d.createGain(),d.connect(e.input,e.output),e},d.panner=function(e){var t={},n=d.createGain(1),r=d.createGain(0),o=d.createChannelMerger(2);return t.input=d.createGain(),t.output=d.createGain(),t.value=e,t.value>1?t.value=1:-1>t.value&&(t.value=-1),n.gain.value=1-100*.01*((1+t.value)/2),r.gain.value=1-n.gain.value,d.connect(t.input,[n,r]),d.connect({node:n,channel:0},{node:o,channel:0}),d.connect({node:r,channel:0},{node:o,channel:1}),d.connect(o,t.output),t},d.play=function(e,t){t=t||0,e.start(t)},d.stop=function(e,t){t=t||0,e.stop(t)},d.reverse=function(e){for(var t=0;e.buffer.numberOfChannels>t;t++)Array.prototype.reverse.call(e.buffer.getChannelData(t));return e};var x=function(e){this.start=function(t){return e.sourceNode.hasOwnProperty("start")?e.sourceNode.start(t):e.sourceNode.noteOn(t),this},this.stop=function(t){return e.sourceNode.hasOwnProperty("stop")?e.sourceNode.stop(t):e.sourceNode.noteOff(t),this}};d.createNode=function(e){var t={};return e=e||{},t.input=d.context().createGain(),t.output=d.context().createGain(),t.nodeType=function(){return e.nodeType||"default"},t.attributes=e.attributes,t.connectedTo=[],e.hasOwnProperty("sourceNode")?x.call(t,e):e.sourceNode=!1,t},d.oscillator=function(e,t){var n,r=d.context().createOscillator();return n=d.createNode({sourceNode:r,nodeType:"oscillator"}),v.call(r,n,["type","frequency","waveType"]),n.type(e||"sine"),n.frequency(t||440),n.waveType=e||"sine",n.nodeType=function(){return"oscillator"},n.fadeIn=function(){return b(this),this},n.fadeOut=function(){return T(this),this},n.detune=function(e){return r.detune.value=e,this},n.type(n.waveType.toLowerCase()),n.isPlaying=function(){return 2===r.playbackState?!0:!1},n.returnNode=function(){return r},d.connect(r,n.output),n},d.gain=function(e){var n,r;return r="function"==typeof this.context().createGain?this.context().createGain():this.context().createGainNode(),n=d.createNode({nodeType:"gain"}),n.params={gain:r.gain},v.call(r,n,["gain"]),i(e)&&e.hasOwnProperty("gain")&&(e=e.gain.value),0>=e&&(e=0),e===t&&(e=1),n.gain(e),d.connect(n.input,r,n.output),n},d.buffer=function(e,n,r){var o=d.createNode({nodeType:"buffer"});e=e||1,n=n||65536,r=r||44100;var a=this.context().createBuffer(e,n,r);return v.call(a,o,["numberOfChannels","bufferSize","sampleRate"]),o.data=function(n){if(n===t){for(var r=[],o=0;e>o;o++)r.push(a.getChannelData(o));return r}},o.buffer=function(){return a},o},d.bufferPlayer=function(e){var n=this.context().createBufferSource();return n.buffer=e,n.start===t&&(n.start=n.noteOn,n.stop=n.noteOff),n},d.filter=function(){var e=d.createNode({nodeType:"filter"}),t={},n=d.context().createBiquadFilter();return i(arguments[0])?(t.type=arguments[0].type||"lowpass",t.frequency=arguments[0].frequency||1e3,t.Q=arguments[0].Q||0):c(arguments[0])&&(t.type=arguments[0]),t.type=t.type||"lowpass",t.Q=t.Q||0,v.call(n,e,["type","frequency","Q"]),e.type(t.type),e.frequency(t.frequency||1e3),e.Q(t.Q||0),d.connect(e.input,n,e.output),e},d.analyser=function(){return this.context().createAnalyser()},d.compressor=function(e){var t=d.createNode({nodeType:"compressor"}),r=this.context().createDynamicsCompressor(),a={threshold:-24,knee:30,ratio:12,attack:.003,release:.25};return e=n(a,e),o(r,e),d.connect(t.input,r,t.output),t},d.processor=function(e,t){var n=e||1024,r=d.context().createScriptProcessor(n,1,1);return"function"==typeof t&&(r.onaudioprocess=function(e){t(e)}),r},d.waveShaper=function(){for(var e=new Float32Array(65536),t=0;32768>t;t++)e[t]=3e4>t?.1:-1;var n=this.context().createWaveShaper();return n.curve=e,n},d.envelope=function(e){var n={};return e=e||{},n.name=e.name||"",n.startLevel=e.startLevel||0,n.maxLevel=e.maxLevel||1,n.minLevel=e.minLevel||0,n.nodeType=function(){return"envelope"},n.attackTime=e.attackTime||1,n.decayTime=e.decayTime||1,n.sustainLevel=e.sustainLevel||1,n.releaseTime=e.releaseTime||1,n.param=e.param||{},n.param.value=n.startLevel,n.autoStop=e.autoStop===t?!0:e.autoStop,n.start=function(e){var t=e||d.now(),n=t+this.attackTime,r=n+this.decayTime,o=r+this.releaseTime;console.log("Start",t),console.log("Attack",n),console.log("Decay",r),console.log("Release",o),this.maxLevel=this.startLevel+this.maxLevel,this.sustainLevel=this.startLevel+this.sustainLevel,h(this.param)&&(console.log("Current time",d.now()),console.log("Setting value at",t),this.param.setValueAtTime(this.startLevel,t+2),console.log("Ramping to value at",n),this.param.exponentialRampToValueAtTime(this.maxLevel,n),this.param.exponentialRampToValueAtTime(this.startLevel+this.sustainLevel,r),this.autoStop&&(console.log(this.param),this.param.exponentialRampToValueAtTime(this.minLevel,o),this.stop(o)))},n.startRelease=function(e){e=e||d.now(),e+=this.releaseTime},n},d.noise=function(){var e,n=this.bufferPlayer(d.noise_buffer.buffer());return e=d.createNode({nodeType:"noise",sourceNode:n,attributes:{color:"white"}}),n.loop=!0,v.call(n,e,["buffer"]),e.color=e.colour=function(n){return n===t?e.attributes.color:(e.attributes.color=n,t)},e.nodeType=function(){return"noise"},e.play=function(e){n.start(e)},e},d.lfo=function(e){var r,o=d.oscillator(),a=this.gain(),u=this.bufferPlayer(d.noise_buffer.buffer()),i={frequency:0,waveType:"triangle",depth:1,target:null,autoStart:!1};return r=d.createNode({nodeType:"noise",sourceNode:u}),e=n(i,e),o.type(e.waveType||"triangle"),a.gain(e.depth),o.frequency(e.frequency),e.autoStart&&o.start(d.now()),o.modulate=function(e){d.connect(a,e)},o.setWaveType=function(e){o.type=o[e.toUpperCase()]},o.frequency=function(e){return e===t?o.frequency.value:(o.frequency.value=e,t)},o.setDepth=function(e){a.gain.value=e},o.modulate(e.target),o},d.getUserAudio=function(e){var t=function(t){var n=d.context().createMediaStreamSource(t);e(n)};navigator.webkitGetUserMedia({audio:!0},t)};var A=function(){(function e(){m.forEach(function(e){e.time<d.now()&&d.disconnect(e.node)}),setTimeout(e,500)})()};return d.init=function(){y(function(){w(),g(),A()},function(e){console.log(e)})},e.tsw=d}(),n.init()})(window),function(e){"use strict";e.tsw=tsw||{};var t={};t.createDelay=function(e){var t=tsw.createNode(),n=tsw.createDelay(),r=tsw.createGain(),o=tsw.createGain(),a=tsw.createGain();return t.settings={delayTime:.5,feedback:.5,effectLevel:.5},e=e||{},n.delayTime.value=e.delayTime||t.settings.delayTime,r.gain.value=e.feedback||t.settings.feedback,o.gain.value=e.effectLevel||t.settings.effectLevel,tsw.connect(t.input,a,n,r,n,o,t.output),tsw.connect(a,n),t},t.createDistortion=function(e){var t={},n=tsw.context.createWaveShaper(),r=tsw.context.createBiquadFilter(),o=tsw.context.createBiquadFilter();return t.settings={distortionLevel:.5},e=e||{},t.input=tsw.createGain(),t.output=tsw.createGain(),tsw.connect(t.input,n,[r,o],t.output),t},t.createPhaser=function(e){var t={},n=[],r=tsw.createGain(),o={rate:8,depth:.5,feedback:.8};e=e||{},r.gain.value=e.gain||o.gain;for(var a=0;o.rate>a;a++)n[a]=tsw.context.createBiquadFilter(),n[a].type=7,n[a].frequency.value=100*a;t.input=tsw.createGain(),t.output=tsw.createGain();for(var a=0;n.length-1>a;a++)tsw.connect(n[a],n[a+1]);return tsw.connect(t.input,n[0],n[n.length-1],r,n[0]),tsw.connect(n[n.length-1],t.output),t.setCutoff=function(){for(var e=0;n.length>e;e++);},t},t.createReverb=function(e){var t=tsw.context.createConvolver(),n=tsw.createGain(),r={},o={effectLevel:.5,reverbTime:.5,reverbType:"spring",reverbPath:""};return e=e||{},n.gain.value=e.effectLevel||o.effectLevel,tsw.load({hall:"/effects/reverb/responses/bright-hall.wav",room:"/effects/reverb/responses/medium-room.wav",spring:"/effects/reverb/responses/feedback-spring.wav"},function(e){o.reverbPath=e[o.reverbType],t.buffer=o.reverbPath,r.input=tsw.createGain(),r.output=tsw.createGain(),tsw.connect(r.input,[r.output,t]),tsw.connect(t,n),tsw.connect(n,r.output)}),r},t.createTremolo=function(e){var t={},n=(tsw.createGain(),this.createLFO()),r=this;return e=e||{},t.input=tsw.createGain(),t.connect=function(e){t.input.connect(e),n.modulate(t.input.gain),n.start(r.now())},t.setRate=function(e){n.setFrequency(e)},t.setDepth=function(e){n.setDepth(e)},t},tsw.fx=t}(window),function(){"use strict";var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];e.push.apply(e,e);var t=["unison","flat 2nd","2nd","minor 3rd","major 3rd","perfect 4th","flat 5th","perfect 5th","minor 6th","major 6th","minor 7th","major 7th","octave","flat 9th","9th","sharp 9th","major 10th","11th","augmented 11th","perfect 12th","flat 13th","13th"],n=function(t){for(var n,r=e.length,o=0;r>o;o++)if(t.toUpperCase()===e[o])return n=o,o;return null},r=function(t){var r=[],o=n(t);return r.push(e[o]),r.push(e[o+2]),r.push(e[o+4]),r.push(e[o+5]),r.push(e[o+7]),r.push(e[o+9]),r.push(e[o+11]),r.push(e[o+12]),r},o=function(t){var r=[],o=n(t);return r.push(e[o]),r.push(e[o+2]),r.push(e[o+3]),r.push(e[o+5]),r.push(e[o+7]),r.push(e[o+8]),r.push(e[o+10]),r.push(e[o+12]),r},a=function(e){return"string"!=typeof e||e.length>3?!1:!0};tsw.chord=function(t){var r={},o=[],a=0;return Array.isArray(t)?!1:(t=t.toLowerCase(),r.rootNote=t[0].toUpperCase(),r.isMajor=t.indexOf("maj")>-1,r.isMinor=!r.isMajor&&t.indexOf("m")>-1,r.is7th=t.indexOf("7")>-1,r.notes=[],r.is7th||(r.octave=t.match(/\d/g)),r.isMajor||r.isMinor||t.is7th||(r.isMajor=!0),a=n(r.rootNote),o.push(a),t.isMinor?o.push(a+tsw.semitoneDifference("minor 3rd")):o.push(a+tsw.semitoneDifference("major 3rd")),o.push(a+tsw.semitoneDifference("perfect 5th")),o.push(a+tsw.semitoneDifference("octave")),o.forEach(function(t){r.notes.push(e[t])}),r.notes)},tsw.scale=function(e,t){return"minor"===t?o(e):r(e)},tsw.semitoneDifference=function(e){for(var n=t.length,r=0;n>r;r++)if(e===t[r])return r},tsw.flat=function(e){var t;return e=e.replace("#","b"),t=String.fromCharCode(e[0].toUpperCase().charCodeAt(0)+1),"H"===t&&(t="A"),t+=e.substr(1)},tsw.sharp=function(e){var t,n=0;return-1===e.indexOf("b")?e:(e=e.replace("b","#"),t=String.fromCharCode(e[0].toUpperCase().charCodeAt(0)-1),"@"===t&&(t="G"),"B"===t&&(n=e.search(/\d/),n>-1&&(e=e.substring(0,n)+(e[n]-1)+e.substring(n+1))),t+=e.substr(1))},tsw.frequency=function(t){var n,r,o,u;return a(t)===!1?!1:(o=t.search(/\d/),n=parseInt(t.slice(-1)),isNaN(n)&&(n=4),t=this.sharp(t),u=t,o>-1&&(u=t.substr(0,o)),r=e.indexOf(u.toUpperCase()),r+=12*n,parseFloat(440*Math.pow(2,(r-57)/12),10))}}(window),function(){"use strict";tsw=tsw||{},tsw.MIDISupport=function(){return"function"==typeof navigator.requestMIDIAccess},tsw.getUserMIDI=function(e,t){tsw.MIDISupport()&&navigator.requestMIDIAccess().then(e,t)},tsw.note=function(e){var t=e%12,n=Math.floor(e/12),r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return r.push.apply(r,r),r[t]+n}}(window);